{$layout}
{$template "../settings_menu"}

<style>
    .cc-page {
        display: flex;
        gap: 20px;
    }
    .cc-summary {
        flex: 1.4;
    }
    .cc-summary .card {
        box-shadow: 0 1px 3px rgba(0,0,0,0.08);
        border: 1px solid #e8eef5;
    }
    .cc-summary .stat {
        font-size: 22px;
        font-weight: 600;
        color: #1b64f0;
    }
    .cc-summary .label {
        color: #5f6b7a;
    }
    .cc-form-panel {
        flex: 2;
        background: #fff;
        border: 1px solid #e8eef5;
        box-shadow: 0 1px 3px rgba(0,0,0,0.08);
        padding: 18px 18px 6px;
        border-radius: 6px;
    }
    .cc-form-panel h3 {
        margin: 0 0 8px;
        font-size: 16px;
    }
    .cc-form-panel .sub {
        color: #5f6b7a;
        margin-bottom: 18px;
    }
    @media (max-width: 1180px) {
        .cc-page {
            flex-direction: column;
        }
    }
</style>

<div class="left-right-box-container">
    {$template "/left_menu"}

    <div class="right-box">
        <div class="cc-page">
            <div class="cc-summary">
                <div class="ui grid">
                    <div class="eight wide column">
                        <h4 style="margin:0;">CC 状态摘要</h4>
                    </div>
                    <div class="eight wide column right aligned">
                        <button class="ui button mini basic" :class="{'loading': summaryLoading}" @click.prevent="loadSummary">刷新摘要</button>
                    </div>
                </div>
                <div class="ui cards three stackable">
                    <div class="card">
                        <div class="content">
                            <div class="header">当前策略</div>
                            <div class="meta">模板 / 自定义</div>
                            <div class="description">
                                <div class="stat">{{ ccSummary.templateName }}</div>
                                <div class="label">是否开启：{{ ccSummary.isOn ? '是' : '否' }}</div>
                            </div>
                        </div>
                    </div>
                    <div class="card">
                        <div class="content">
                            <div class="header">近5分钟拦截</div>
                            <div class="meta">验证码 / 封禁</div>
                            <div class="description">
                                <div class="stat">{{ ccSummary.block5m }}</div>
                                <div class="label">验证码 {{ ccSummary.captcha5m }} ，封禁 IP {{ ccSummary.ban5m }}</div>
                            </div>
                        </div>
                    </div>
                    <div class="card">
                        <div class="content">
                            <div class="header">计数器状态</div>
                            <div class="meta">键数量 / 上限</div>
                            <div class="description">
                                <div class="stat">{{ ccSummary.keys }}/{{ ccSummary.maxKeys }}</div>
                                <div class="label">预估内存 {{ ccSummary.memMB }} MB</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="cc-form-panel">
                <h3>CC 防护配置</h3>
                <div class="sub">基于当前 UI 框架的卡片式表单，保留原有表单逻辑，新增摘要卡片方便快速检查状态。</div>
                <form method="post" class="ui form" data-tea-action="$" data-tea-success="success">
                    <input type="hidden" name="webId" :value="webId"/>
                    <csrf-token></csrf-token>

                    <http-cc-config-box :v-cc-config="ccConfig"></http-cc-config-box>

                    <submit-btn></submit-btn>
                </form>
            </div>
        </div>
    </div>
</div>
