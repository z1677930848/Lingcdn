<!DOCTYPE html>
<html lang="zh">
<head>
    <title>{$ htmlEncode .teaTitle}</title>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=0">
    {$if eq .teaFaviconFileId 0}
    <link rel="shortcut icon" href="/images/favicon.png"/>
    {$else}
    <link rel="shortcut icon" href="/ui/image/{$.teaFaviconFileId}"/>
    {$end}
    <link rel="stylesheet" type="text/css" href="/css/iview.css?v={$ .teaVersion}" media="all"/>
    <link rel="stylesheet" type="text/css" href="/css/unified-ui.css?v={$ .teaVersion}" media="all"/>
    <link rel="stylesheet" type="text/css" href="/_/@default/@layout.css?v={$ .teaVersion}" media="all"/>
    <link rel="stylesheet" type="text/css" href="/_/@default/@layout_override.css?v={$ .teaVersion}" media="all"/>

    {$TEA.VUE}
    <script type="text/javascript" src="/js/iview.min.js"></script>
    <script type="text/javascript">
        if (window.ViewUI && window.Vue) { Vue.use(window.ViewUI) }
        else if (window.iview && window.Vue) { Vue.use(window.iview) }
    </script>
    {$echo "header"}
    <script type="text/javascript" src="/_/@default/@layout.js?v={$ .teaVersion}"></script>
    <script type="text/javascript" src="/js/components.js"></script>
    <script type="text/javascript" src="/js/utils.min.js"></script>
    <script type="text/javascript" src="/js/sweetalert2/dist/sweetalert2.all.min.js" async></script>
    <script type="text/javascript" src="/js/date.tea.js"></script>
    <script type="text/javascript" src="/js/langs/base.js?v={$ .teaVersion}"></script>
    <script type="text/javascript" src="/js/langs/{$.teaLang}.js?v={$ .teaVersion}"></script>
    <link rel="stylesheet" type="text/css" href="/js/langs/{$.teaLang}.css?v={$ .teaVersion}"/>
</head>
<body class="app-shell">
<div class="layout-root" v-cloak="">
    <div class="app-layout">
        <div class="app-header app-topbar">
            <div class="brand" @click.prevent="sidebarCollapsed = false">
                <Icon type="ios-leaf" v-if="teaLogoFileId == 0"/>
                <img v-if="teaLogoFileId > 0" :src="'/ui/image/' + teaLogoFileId" alt="logo" class="brand-logo"/>
                <div class="brand-text">
                    <span class="brand-title">{{teaTitle}}</span>
                    <span class="brand-version" v-if="teaShowVersion">v{{teaVersion}}<span v-if="teaVersion.split('.').length == 4"> beta</span></span>
                </div>
            </div>
            <div class="header-actions">
                <Tooltip content="集群同步" placement="bottom" v-if="teaCheckNodeTasks && doingNodeTasks.isUpdated">
                    <a href="" class="action-link" @click.prevent="showNodeTasks()">
                        <Icon type="ios-cloud-outline" :class="{'is-rotating': doingNodeTasks.isDoing && !doingNodeTasks.hasError}"/>
                        <span v-if="doingNodeTasks.hasError" class="action-text error">同步失败</span>
                        <span v-else-if="doingNodeTasks.isDoing" class="action-text">同步中</span>
                        <span v-else class="action-text muted">已同步</span>
                    </a>
                </Tooltip>

                <Tooltip content="DNS同步" placement="bottom" v-if="teaCheckDNSTasks && doingDNSTasks.isUpdated">
                    <a href="" class="action-link" @click.prevent="showDNSTasks()">
                        <Icon type="ios-globe-outline" :class="{'is-rotating': doingDNSTasks.isDoing && !doingDNSTasks.hasError}"/>
                        <span v-if="doingDNSTasks.hasError" class="action-text error">同步失败</span>
                        <span v-else-if="doingDNSTasks.isDoing" class="action-text">同步中</span>
                        <span v-else class="action-text muted">已同步</span>
                    </a>
                </Tooltip>

                <Tooltip content="消息" placement="bottom">
                    <a href="" class="action-link" :class="{active:teaMenu == 'message'}" @click.prevent="showMessages()">
                        <Badge :count="globalMessageBadge" :offset="[6, -4]">
                            <Icon type="ios-bell-outline"/>
                        </Badge>
                        <span class="action-text" v-if="globalMessageBadge == 0">消息</span>
                        <span class="action-text" v-else>消息({{globalMessageBadge}})</span>
                    </a>
                </Tooltip>

                <Dropdown trigger="click" placement="bottom-end">
                    <a href="/settings/profile" class="action-link">
                        <Avatar v-if="teaUserAvatar.length > 0" :src="teaUserAvatar" size="small"/>
                        <Icon v-else type="ios-person-outline"/>
                        <span class="action-text muted">{{teaUsername}}</span>
                    </a>
                    <DropdownMenu slot="list">
                        <DropdownItem>
                            <a href="/settings/profile">账户设置</a>
                        </DropdownItem>
                        <DropdownItem>
                            <a :href="Tea.url('logout')">安全退出</a>
                        </DropdownItem>
                    </DropdownMenu>
                </Dropdown>

                <a href="" class="action-link" title="切换语言" @click.prevent="switchLang">
                    <Icon type="ios-globe-outline"/>
                </a>
                <a href="" class="action-link" title="切换主题" @click.prevent="changeTheme()">
                    <Icon type="ios-contrast"/>
                </a>
                <a :href="Tea.url('logout')" class="action-link danger" title="安全退出登录">
                    <Icon type="md-exit"/>
                </a>
                <a href="" class="action-link ghost" title="收起侧边栏" @click.prevent="toggleSidebar">
                    <Icon :type="sidebarCollapsed ? 'md-menu' : 'md-menu'"/>
                </a>
            </div>
        </div>

        <div class="app-body">
            <aside class="app-sider app-sidebar main-menu" :class="{'is-collapsed': sidebarCollapsed}">
                <div class="sider-menu">
                    <div class="sider-section" v-for="module in teaModules" v-if="module.isOn !== false">
                        <div class="sider-title" :class="{'is-active': teaMenu == module.code}" @click="toggleModule(module)">
                            <Icon :type="module.icon != null ? module.icon : 'md-apps'"/>
                            <span class="title-text">{{module.name}}</span>
                            <span class="subtitle" v-if="module.subtitle != null && module.subtitle.length > 0">{{module.subtitle}}</span>
                            <Icon type="ios-arrow-down" class="pull-arrow" v-if="module.subItems != null && module.subItems.length > 0"/>
                        </div>
                        <div class="sider-sub" v-if="module.subItems != null && module.subItems.length > 0" v-show="teaMenu == module.code">
                            <a class="sider-item" v-for="subItem in module.subItems" v-if="subItem.isOn !== false" :href="subItem.url" :class="{'is-active': subItem.code == teaSubMenu}">
                                <span v-if="subItem.name != '-'">{{subItem.name}}</span>
                                <span class="badge" v-if="subItem.badge != null && subItem.badge > 0">
                                    <span v-if="subItem.badge < 100">{{subItem.badge}}</span>
                                    <span v-else>99+</span>
                                </span>
                            </a>
                        </div>
                    </div>
                </div>
            </aside>

            <main class="app-content app-main"
                  :class="{'without-menu':teaSubMenus.menus == null || teaSubMenus.menus.length == 0 || (teaSubMenus.menus.length == 1 && teaSubMenus.menus[0].alwaysActive), 'without-secondary-menu':teaSubMenus.alwaysMenu == null || teaSubMenus.alwaysMenu.items.length <= 1, 'without-footer':!teaShowOpenSourceInfo}">
                <div class="app-tabbar" v-if="teaTabbar.length > 1">
                    <a class="tab-item" v-for="item in teaTabbar" :href="item.url"
                       :class="{'is-active':item.isActive && !item.isDisabled, 'is-right':item.isRight, 'is-title': item.isTitle, 'is-disabled': item.isDisabled}">
                        <Icon :type="item.icon" v-if="item.icon != null && item.icon.length > 0" class="tab-icon"/>
                        <span class="tab-text">{{item.name}}<span v-if="item.subName.length > 0">({{item.subName}})</span></span>
                        <span class="tab-text" v-if="item.isTitle && typeof _data.node == 'object'">{{node.name}}</span>
                    </a>
                </div>
                <div class="page-container main-box">
                    {$TEA.VIEW}
                    <div class="clear"></div>
                </div>
                {$template "/footer"}
            </main>
        </div>
    </div>
</div>
{$echo "footer"}
</body>
</html>
